<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Borang Serahan Aset</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap');

        body { font-family: 'Poppins', sans-serif; background: #f1f5f9; margin: 0; padding: 20px; color: #1e293b; }

        /* BUTTON BACK */
        .btn-back { display: inline-flex; align-items: center; text-decoration: none; color: #64748b; font-weight: 600; margin-bottom: 20px; }
        .btn-back:hover { color: #2563eb; }

        /* CARD */
        .card { background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); max-width: 600px; margin: 0 auto; padding: 40px; }
        .form-header { text-align: center; margin-bottom: 30px; }
        .form-header h2 { margin: 0; font-size: 1.8rem; color: #1e293b; }
        .form-header p { color: #94a3b8; margin-top: 5px; }

        /* INPUTS */
        label { display: block; margin-bottom: 8px; font-weight: 500; color: #334155; font-size: 0.9rem; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 10px; margin-bottom: 20px; box-sizing: border-box; font-family: inherit; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }

        /* SECTION */
        .section-box { background: #f8fafc; padding: 25px; border-radius: 16px; margin-bottom: 25px; border: 1px solid #e2e8f0; }
        h4.section-title { margin: 0 0 20px 0; color: #2563eb; font-size: 1rem; }

        /* CANVAS SIGNATURE */
        .canvas-wrapper { border: 2px dashed #cbd5e1; border-radius: 12px; background: #fff; position: relative; overflow: hidden; margin-bottom: 20px; touch-action: none; }
        canvas { width: 100%; height: 200px; display: block; cursor: crosshair; }
        .btn-clear-sign { position: absolute; bottom: 10px; right: 10px; background: #ef4444; color: white; padding: 5px 12px; border-radius: 8px; font-size: 0.75rem; cursor: pointer; }

        /* SUBMIT BTN */
        .btn-blue { width: 100%; padding: 16px; background: #2563eb; color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 1rem; cursor: pointer; transition: 0.3s; }
        .btn-blue:hover { background: #1d4ed8; transform: translateY(-2px); }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

    <div style="max-width:600px; margin:0 auto;">
        <a href="menu.html" class="btn-back">‚¨Ö Kembali ke Menu</a>
    </div>

    <div class="card">
        <div class="form-header">
            <h2>üìù Borang Serahan Aset</h2>
            <p>Sila isi maklumat aset dan lokasi dengan lengkap.</p>
        </div>
        
        <div class="section-box">
            <h4 class="section-title">üë§ Maklumat Pemilik</h4>
            <label>Nama Cikgu / Staff</label>
            <input type="text" id="c_name" placeholder="Nama Penuh Anda">
            
            <label>Lokasi YPKT</label>
            <select id="c_loc">
                <option value="">-- Sila Pilih Lokasi --</option>
                <option>YPKT Ibu Pejabat</option>
                <option>YPKT Kuala Nerus</option>
                <option>YPKT Marang</option>
                <option>YPKT Hulu Terengganu</option>
                <option>YPKT Dungun</option>
                <option>YPKT Kemaman</option>
                <option>YPKT Besut</option>
                <option>YPKT Setiu</option>
            </select>

            <label>Nama Taska / Unit (Jika ada)</label>
            <input type="text" id="c_taska" placeholder="Cth: Taska Permata 1 / Unit Kewangan">
        </div>

        <div class="section-box">
            <h4 class="section-title">üíª Maklumat Aset</h4>
            <label>Jenis Aset</label>
            <select id="c_type">
                <option>Laptop</option>
                <option>PC</option>
                <option>Printer</option>
                <option>Lain-lain</option>
            </select>
            
            <label>No Siri (Serial No.)</label>
            <input type="text" id="c_serial" placeholder="Lihat sticker belakang/bawah aset">
            
            <label>Masalah / Kerosakan</label>
            <textarea id="c_issue" rows="3" placeholder="Terangkan masalah yang dihadapi..."></textarea>
        </div>

        <label>Tarikh Hari Ini</label>
        <input type="text" id="c_date" readonly style="background:#e2e8f0; color:#64748b; font-weight:bold;">
        
        <label>Tandatangan Pelapor</label>
        <div class="canvas-wrapper">
            <canvas id="cvs_cikgu"></canvas>
            <div class="btn-clear-sign" id="clearBtn">Padam</div>
        </div>

        <button class="btn-blue" id="submitBtn">HANTAR BORANG</button>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js";

        // ==========================================================
        // ‚ö†Ô∏è SILA COPY DAN PASTE CONFIG FIREBASE DARI LINK ASAL DI SINI ‚ö†Ô∏è
        // ==========================================================
        const firebaseConfig = {
            apiKey: "MASUKKAN_API_KEY_DI_SINI",
            authDomain: "MASUKKAN_AUTH_DOMAIN_DI_SINI",
            databaseURL: "MASUKKAN_DATABASE_URL_DI_SINI",
            projectId: "MASUKKAN_PROJECT_ID_DI_SINI",
            storageBucket: "MASUKKAN_BUCKET_DI_SINI",
            messagingSenderId: "MASUKKAN_MESSAGING_ID",
            appId: "MASUKKAN_APP_ID"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ==========================================================
        // SETUP TARIKH & CANVAS (TIDAK PERLU UBAH)
        // ==========================================================
        
        // Auto Tarikh
        const today = new Date().toLocaleDateString('ms-MY', { day: '2-digit', month: 'long', year: 'numeric' });
        document.getElementById('c_date').value = today;

        // Setup Canvas
        const canvas = document.getElementById('cvs_cikgu');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;

        function resizeCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 200;
            ctx.lineWidth = 2;
            ctx.lineCap = "round";
            ctx.strokeStyle = "#000";
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
        }

        function startDraw(e) {
            isDrawing = true;
            const pos = getPos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
            e.preventDefault();
        }

        function draw(e) {
            if (!isDrawing) return;
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            e.preventDefault();
        }

        function stopDraw() { isDrawing = false; }

        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDraw);
        canvas.addEventListener('mouseout', stopDraw);
        canvas.addEventListener('touchstart', startDraw, {passive: false});
        canvas.addEventListener('touchmove', draw, {passive: false});
        canvas.addEventListener('touchend', stopDraw);

        document.getElementById('clearBtn').addEventListener('click', () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });

        // ==========================================================
        // FUNGSI SUBMIT KE DATABASE 'serahan_aset'
        // ==========================================================
        document.getElementById('submitBtn').addEventListener('click', () => {
            
            // Ambil value dari form
            const nama = document.getElementById('c_name').value.trim();
            const lokasi = document.getElementById('c_loc').value;
            const taska = document.getElementById('c_taska').value.trim();
            const type = document.getElementById('c_type').value;
            const serial = document.getElementById('c_serial').value.trim();
            const issue = document.getElementById('c_issue').value.trim();
            const tarikh = document.getElementById('c_date').value;

            // Check Tandatangan
            const blank = document.createElement('canvas');
            blank.width = canvas.width; blank.height = canvas.height;
            const isSignBlank = canvas.toDataURL() === blank.toDataURL();

            // Validasi mudah
            if(!nama || !lokasi || !serial || !issue) {
                Swal.fire('Ralat', 'Sila lengkapkan Nama, Lokasi, No Siri dan Masalah.', 'warning');
                return;
            }

            if(isSignBlank) {
                Swal.fire('Ralat', 'Sila turunkan tandatangan.', 'warning');
                return;
            }

            // Tunjuk loading
            Swal.fire({
                title: 'Sedang Hantar...',
                text: 'Sila tunggu sebentar.',
                allowOutsideClick: false,
                didOpen: () => { Swal.showLoading(); }
            });

            // Hantar ke Firebase Database
            // Saya namakan table ini 'serahan_aset' supaya sesuai dengan nama borang
            const newRef = push(ref(db, 'serahan_aset')); 
            
            set(newRef, {
                nama: nama,
                lokasi: lokasi,
                taska: taska,
                jenis: type,
                no_siri: serial,
                masalah: issue,
                tarikh: tarikh,
                sign_cikgu: canvas.toDataURL(),
                status: 'Baru Terima', // Status default
                timestamp: Date.now()
            })
            .then(() => {
                Swal.fire({
                    title: 'Berjaya!',
                    text: 'Borang serahan aset telah direkodkan.',
                    icon: 'success',
                    confirmButtonColor: '#2563eb'
                }).then(() => {
                    // Kembali ke menu atau reload
                    window.location.href = 'menu.html';
                });
            })
            .catch((err) => {
                console.error(err);
                Swal.fire('Ralat Sistem', 'Gagal menghantar data: ' + err.message, 'error');
            });
        });

    </script>
</body>
</html>
