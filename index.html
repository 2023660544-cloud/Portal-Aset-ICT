<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Portal Aset ICT (Mobile)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        :root {
            --primary: #2563eb;
            --dark: #1e293b;
            --light: #f1f5f9;
            --sidebar-width: 260px;
        }

        body { font-family: 'Poppins', sans-serif; margin: 0; background: var(--light); height: 100vh; overflow: hidden; touch-action: pan-y; }

        /* ===========================
           1. LANDING PAGE
           =========================== */
        #landing-page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #334155 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; z-index: 2000; transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .landing-content { text-align: center; width: 90%; max-width: 400px; }
        .menu-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 30px; }
        
        .menu-card {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            padding: 20px; border-radius: 15px; cursor: pointer; display: flex; align-items: center; gap: 15px;
            backdrop-filter: blur(10px); transition: 0.2s;
        }
        .menu-card:active { transform: scale(0.95); background: rgba(255,255,255,0.2); }
        .menu-icon { font-size: 2rem; }
        .menu-text { font-weight: 600; font-size: 1.1rem; text-align: left; }
        .menu-sub { font-size: 0.8rem; color: #cbd5e1; text-align: left; font-weight: normal;}

        /* ===========================
           2. APP CONTAINER
           =========================== */
        #app-container {
            display: flex; height: 100vh; width: 100%; position: absolute; top: 0; left: 0;
            transform: translateY(100%); transition: transform 0.5s ease-in-out; opacity: 0; flex-direction: column;
        }
        #app-container.active { transform: translateY(0); opacity: 1; }

        /* MOBILE HEADER (HAMBURGER) */
        .mobile-header {
            background: #fff; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 50; height: 60px; box-sizing: border-box;
        }
        .hamburger-btn { font-size: 1.5rem; background: none; border: none; cursor: pointer; color: var(--dark); padding: 5px; }
        .page-title { font-weight: 700; color: var(--dark); font-size: 1.1rem; }

        /* SIDEBAR (MENU) */
        .sidebar { 
            position: fixed; top: 0; left: 0; height: 100%; width: var(--sidebar-width);
            background: #fff; z-index: 1000; transform: translateX(-100%); transition: transform 0.3s ease;
            box-shadow: 5px 0 15px rgba(0,0,0,0.1); display: flex; flex-direction: column; padding: 20px; box-sizing: border-box;
        }
        .sidebar.open { transform: translateX(0); }
        
        /* OVERLAY (GELAP BELAKANG MENU) */
        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 900; display: none; opacity: 0; transition: opacity 0.3s;
        }
        .sidebar-overlay.show { display: block; opacity: 1; }

        .brand { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        .nav-item { padding: 15px; margin-bottom: 10px; color: #64748b; border-radius: 10px; font-weight: 500; display: flex; align-items: center; gap: 15px; transition: 0.2s; }
        .nav-item.active { background: #eff6ff; color: var(--primary); font-weight: 700; }
        .nav-home { margin-top: auto; background: var(--dark); color: white !important; }

        /* MAIN CONTENT */
        .main-content { flex: 1; background: #f8fafc; padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        
        /* CARDS & FORMS */
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); margin-bottom: 20px; }
        .form-row { display: grid; grid-template-columns: 1fr; gap: 15px; } /* Mobile: 1 Column */
        
        input, select, textarea { width: 100%; padding: 14px; border: 1px solid #cbd5e1; border-radius: 10px; margin-top: 5px; box-sizing: border-box; font-size: 16px; /* Prevent zoom on iPhone */ background: #f8fafc; }
        label { font-weight: 600; font-size: 0.9rem; color: #475569; margin-top: 15px; display: block; }
        
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: 700; margin-top: 20px; font-size: 1rem; color: white; cursor: pointer; }
        .btn-primary { background: var(--primary); box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3); }
        .sig-pad { border: 2px dashed #cbd5e1; border-radius: 10px; width: 100%; background: #fff; touch-action: none; }

        /* DESKTOP VIEW (MEDIA QUERY) */
        @media (min-width: 769px) {
            #landing-page { display: flex; flex-direction: row; }
            .landing-content { text-align: center; }
            .menu-grid { grid-template-columns: repeat(3, 1fr); max-width: 800px; }
            .menu-card { flex-direction: column; text-align: center; width: 180px; padding: 30px 20px; }
            .menu-text { text-align: center; } .menu-sub { text-align: center; }
            
            #app-container { flex-direction: row; }
            .mobile-header { display: none; }
            .sidebar { position: relative; transform: none; width: 280px; box-shadow: none; border-right: 1px solid #e2e8f0; }
            .form-row { grid-template-columns: 1fr 1fr; }
            .hamburger-btn { display: none; }
            .main-content { padding: 40px; }
        }
    </style>
</head>
<body>

    <div id="landing-page">
        <div class="landing-content">
            <h1 style="margin:0; font-size:2.5rem;">üì± Portal Aset</h1>
            <p style="color:#94a3b8; margin-bottom:30px">Sistem versi mudah alih</p>

            <div class="menu-grid">
                <div class="menu-card" onclick="enterSystem('page-cikgu')">
                    <span class="menu-icon">üì•</span>
                    <div><div class="menu-text">Borang Aset</div><div class="menu-sub">Hantar Peralatan</div></div>
                </div>
                <div class="menu-card" onclick="enterSystem('page-admin-check')">
                    <span class="menu-icon">üîê</span>
                    <div><div class="menu-text">Admin IT</div><div class="menu-sub">Login Pegawai</div></div>
                </div>
                <div class="menu-card" onclick="enterSystem('page-notepad')">
                    <span class="menu-icon">üìå</span>
                    <div><div class="menu-text">Nota</div><div class="menu-sub">Catatan Peribadi</div></div>
                </div>
            </div>
        </div>
    </div>

    <div id="app-container">
        
        <div class="mobile-header">
            <button class="hamburger-btn" onclick="toggleSidebar()">‚ò∞</button>
            <div class="page-title" id="header-title">Menu Utama</div>
            <div style="width:30px"></div> </div>

        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

        <div class="sidebar" id="sidebar">
            <div class="brand">üöÄ E-Aset Pro <small style="font-size:0.7rem; color:#94a3b8">v6 Mobile</small></div>
            
            <div class="nav-item" id="nav-cikgu" onclick="switchTab('page-cikgu')"><span>üìù</span> Borang Serahan</div>
            <div class="nav-item" id="nav-admin" onclick="checkAdmin()"><span>üõ†Ô∏è</span> Dashboard IT</div>
            <div class="nav-item" id="nav-note" onclick="switchTab('page-notepad')"><span>üìå</span> Notepad</div>

            <div class="nav-item nav-home" onclick="exitSystem()">üè† Menu Utama</div>
        </div>

        <div class="main-content">
            
            <div id="page-cikgu" class="page-section active">
                <div class="card">
                    <h2>Borang Serahan</h2>
                    <div class="form-row">
                        <div><label>Nama:</label><input type="text" id="c_name"></div>
                        <div><label>Aset:</label>
                            <select id="c_asset">
                                <option>Printer</option><option>Laptop</option><option>PC</option><option>Projector</option>
                            </select>
                        </div>
                    </div>
                    <div><label>No. Siri (Wajib):</label><input type="text" id="c_serial" style="text-transform:uppercase"></div>
                    <div><label>Tarikh:</label><input type="date" id="c_date"></div>
                    <div><label>Masalah:</label><textarea id="c_note" rows="3"></textarea></div>
                    
                    <label>Tandatangan:</label>
                    <canvas id="cvs-cikgu" class="sig-pad" height="150"></canvas>
                    <div onclick="clearCvs('cvs-cikgu')" style="color:red; text-align:right; margin-top:5px; font-size:0.8rem">Padam Sign</div>
                    
                    <button class="btn btn-primary" onclick="submitForm()">HANTAR</button>
                </div>
            </div>

            <div id="page-admin" class="page-section" style="display:none">
                <div class="card">
                    <h2 style="display:flex; justify-content:space-between">Dashboard <button onclick="downloadExcel()" style="background:#10b981; color:white; border:none; padding:5px 10px; border-radius:5px; font-size:0.8rem">Excel</button></h2>
                    <div id="pending-list"></div>
                    <div style="overflow-x:auto; margin-top:20px">
                        <table id="db-table" style="width:100%; border-collapse:collapse; font-size:0.8rem">
                            <thead><tr style="background:#f1f5f9; text-align:left"><th>Tarikh</th><th>Nama</th><th>Status</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="page-process" class="page-section" style="display:none">
                <button onclick="switchTab('page-admin')" style="background:#e2e8f0; border:none; padding:10px; border-radius:8px; margin-bottom:10px">‚¨Ö Kembali</button>
                <div class="card" style="border-top:4px solid #f59e0b">
                    <h3>Proses Aset</h3>
                    <div id="process-info" style="background:#eff6ff; padding:10px; margin-bottom:15px; border-radius:8px; font-size:0.9rem"></div>
                    <label>Nama IT:</label><input type="text" id="it_name">
                    <label>Status:</label><select id="it_status"><option>Baiki</option><option>Simpan</option><option>Pulang</option></select>
                    <label>Sign IT:</label><canvas id="cvs-it" class="sig-pad" height="150"></canvas>
                    <button class="btn btn-primary" onclick="saveIT()">SIMPAN</button>
                </div>
            </div>

            <div id="page-notepad" class="page-section" style="display:none">
                <div class="card">
                    <h2>Nota Pantas</h2>
                    <input type="text" id="note-text" placeholder="Tulis...">
                    <button class="btn btn-primary" onclick="addNote()" style="margin-top:10px; padding:10px">Tambah</button>
                    <div id="note-grid" style="margin-top:20px; display:grid; gap:10px"></div>
                </div>
            </div>

        </div>
    </div>

<script>
    // --- 1. UI LOGIC (MOBILE) ---
    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('open');
        document.querySelector('.sidebar-overlay').classList.toggle('show');
    }

    function enterSystem(page) {
        if(page === 'page-admin-check') { checkAdmin(); return; }
        document.getElementById('landing-page').style.transform = 'translateY(-100%)';
        setTimeout(() => {
            document.getElementById('app-container').classList.add('active');
            switchTab(page);
        }, 300);
    }

    function exitSystem() {
        document.getElementById('app-container').classList.remove('active');
        toggleSidebar(); // Close sidebar if open
        setTimeout(() => {
            document.getElementById('landing-page').style.transform = 'translateY(0)';
        }, 300);
    }

    function switchTab(id) {
        // Hide all pages
        ['page-cikgu','page-admin','page-process','page-notepad'].forEach(p => {
            document.getElementById(p).style.display = 'none';
        });
        // Show selected
        document.getElementById(id).style.display = 'block';
        
        // Update Sidebar Styles
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        if(id.includes('cikgu')) document.getElementById('nav-cikgu').classList.add('active');
        if(id.includes('admin') || id.includes('process')) document.getElementById('nav-admin').classList.add('active');
        if(id.includes('note')) document.getElementById('nav-note').classList.add('active');

        // Update Header Title
        const titles = {'page-cikgu':'Borang Aset', 'page-admin':'Dashboard IT', 'page-notepad':'Nota', 'page-process':'Proses'};
        document.getElementById('header-title').innerText = titles[id] || 'E-Aset';

        // Close sidebar automatically on mobile
        if(window.innerWidth < 769) {
            document.getElementById('sidebar').classList.remove('open');
            document.querySelector('.sidebar-overlay').classList.remove('show');
        }

        // Resize Canvas fix
        setTimeout(() => { 
            resizeCanvas('cvs-cikgu'); resizeCanvas('cvs-it');
        }, 100);
    }

    // --- 2. DATA LOGIC ---
    let db = JSON.parse(localStorage.getItem('asetDB_v6')) || [];
    let notes = JSON.parse(localStorage.getItem('notesDB')) || [];
    let currentId = null;
    document.getElementById('c_date').valueAsDate = new Date();

    function resizeCanvas(id) {
        const c = document.getElementById(id);
        c.width = c.parentElement.offsetWidth; // Force width to container
    }

    function setupCanvas(id) {
        const c = document.getElementById(id);
        const ctx = c.getContext('2d');
        let isDrawing = false;
        
        // Mouse & Touch Events Combined
        const getPos = (e) => {
            const rect = c.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            return {x,y};
        }
        
        ['mousedown', 'touchstart'].forEach(evt => c.addEventListener(evt, (e)=>{
            if(evt=='touchstart') e.preventDefault(); // Stop scroll
            isDrawing=true; ctx.beginPath(); 
            const p = getPos(e); ctx.moveTo(p.x, p.y);
        }));
        
        ['mousemove', 'touchmove'].forEach(evt => c.addEventListener(evt, (e)=>{
            if(evt=='touchmove') e.preventDefault();
            if(isDrawing){ const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); }
        }));
        
        ['mouseup', 'touchend'].forEach(evt => c.addEventListener(evt, ()=>{ isDrawing=false }));
    }
    setupCanvas('cvs-cikgu'); setupCanvas('cvs-it');
    function clearCvs(id) { 
        const c = document.getElementById(id); 
        c.getContext('2d').clearRect(0,0,c.width,c.height); 
    }

    function submitForm() {
        const name = document.getElementById('c_name').value;
        const serial = document.getElementById('c_serial').value;
        if(!name || !serial) return alert("Isi Nama & No Siri!");
        
        db.push({
            id: Date.now(),
            date: document.getElementById('c_date').value,
            name, serial: serial.toUpperCase(),
            asset: document.getElementById('c_asset').value,
            note: document.getElementById('c_note').value,
            status: 'PENDING', itName: '-'
        });
        localStorage.setItem('asetDB_v6', JSON.stringify(db));
        alert("‚úÖ Berjaya!");
        document.getElementById('c_name').value = "";
        document.getElementById('c_serial').value = "";
        document.getElementById('c_note').value = "";
        clearCvs('cvs-cikgu');
    }

    function checkAdmin() {
        if(prompt("Password IT:") === "admin123") {
            // Force enter if from landing
            document.getElementById('landing-page').style.transform = 'translateY(-100%)';
            document.getElementById('app-container').classList.add('active');
            switchTab('page-admin'); renderAdmin();
        } else alert("Salah!");
    }

    function renderAdmin() {
        const list = document.getElementById('pending-list');
        const tbody = document.querySelector('#db-table tbody');
        list.innerHTML = ""; tbody.innerHTML = "";
        
        db.slice().reverse().forEach(item => {
            tbody.innerHTML += `<tr><td style="border-bottom:1px solid #eee; padding:10px">${item.date}</td><td style="border-bottom:1px solid #eee; padding:10px">${item.name}<br><small>${item.asset}</small></td><td style="border-bottom:1px solid #eee; padding:10px">${item.status}</td></tr>`;
            
            if(item.status === 'PENDING') {
                list.innerHTML += `<div style="background:#fffbeb; border:1px solid #fbbf24; padding:15px; margin-bottom:10px; border-radius:10px; display:flex; justify-content:space-between; align-items:center">
                    <div><b>${item.asset}</b> (${item.serial})<br><small>${item.name}</small></div>
                    <button onclick="process(${item.id})" style="background:#f59e0b; color:white; border:none; padding:8px 12px; border-radius:5px">Proses</button>
                </div>`;
            }
        });
        if(!list.innerHTML) list.innerHTML = "<p style='text-align:center; color:#ccc'>Tiada pending.</p>";
    }

    function process(id) {
        currentId = id;
        const item = db.find(x => x.id === id);
        document.getElementById('process-info').innerHTML = `<b>${item.asset}</b><br>Masalah: ${item.note}`;
        clearCvs('cvs-it');
        switchTab('page-process');
    }

    function saveIT() {
        const idx = db.findIndex(x => x.id === currentId);
        if(idx !== -1) {
            db[idx].itName = document.getElementById('it_name').value;
            db[idx].status = document.getElementById('it_status').value;
            localStorage.setItem('asetDB_v6', JSON.stringify(db));
            alert("Disimpan!");
            switchTab('page-admin'); renderAdmin();
        }
    }

    function addNote() {
        const txt = document.getElementById('note-text').value;
        if(txt) {
            notes.push({id:Date.now(), text:txt});
            localStorage.setItem('notesDB', JSON.stringify(notes));
            document.getElementById('note-text').value="";
            renderNotes();
        }
    }
    function renderNotes() {
        const g = document.getElementById('note-grid');
        g.innerHTML = notes.slice().reverse().map(n => `<div style="background:#fff; padding:15px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.05); display:flex; justify-content:space-between"><span>${n.text}</span><span onclick="delNote(${n.id})" style="color:red; font-weight:bold">‚úï</span></div>`).join('');
    }
    function delNote(id) { notes=notes.filter(n=>n.id!==id); localStorage.setItem('notesDB', JSON.stringify(notes)); renderNotes(); }

    function downloadExcel() {
        let csv = "ID,Tarikh,Nama,Aset,Serial,Status\n" + db.map(r => `${r.id},"${r.date}","${r.name}","${r.asset}","${r.serial}","${r.status}"`).join("\n");
        const link = document.createElement('a');
        link.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
        link.download = 'Data.csv';
        link.click();
    }
</script>

</body>
</html>
