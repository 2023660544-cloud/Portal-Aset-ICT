<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Aset ICT</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        :root {
            --primary: #2563eb;
            --dark: #1e293b;
            --light: #f8fafc;
        }

        body { font-family: 'Poppins', sans-serif; margin: 0; background: var(--light); height: 100vh; overflow: hidden; }

        /* ===========================
           1. LANDING PAGE (MUKA DEPAN)
           =========================== */
        #landing-page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; z-index: 999; transition: transform 0.5s ease-in-out;
        }

        .landing-content { text-align: center; animation: floatUp 0.8s ease-out; }
        .landing-title { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; letter-spacing: 1px; }
        .landing-subtitle { color: #94a3b8; margin-bottom: 50px; font-weight: 300; }

        .menu-grid { display: flex; gap: 30px; justify-content: center; flex-wrap: wrap; }
        
        .menu-card {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            width: 180px; padding: 30px 20px; border-radius: 20px; cursor: pointer;
            transition: 0.3s; backdrop-filter: blur(10px);
        }
        .menu-card:hover { transform: translateY(-10px); background: rgba(255,255,255,0.1); border-color: var(--primary); box-shadow: 0 10px 30px rgba(37, 99, 235, 0.3); }
        .menu-icon { font-size: 3rem; margin-bottom: 15px; display: block; }
        .menu-text { font-weight: 600; font-size: 1.1rem; color: #fff; }
        .menu-sub { font-size: 0.8rem; color: #94a3b8; margin-top: 5px; }

        @keyframes floatUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* ===========================
           2. INNER APP (SISTEM DALAM)
           =========================== */
        #app-container {
            display: flex; height: 100vh; width: 100%; position: absolute; top: 0; left: 0;
            transform: translateX(100%); transition: transform 0.5s ease-in-out; opacity: 0;
        }
        #app-container.active { transform: translateX(0); opacity: 1; }

        /* --- SIDEBAR --- */
        .sidebar { width: 260px; background: #fff; border-right: 1px solid #e2e8f0; display: flex; flex-direction: column; padding: 25px; }
        .brand { font-size: 1.2rem; font-weight: 700; color: var(--dark); margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .nav-item { padding: 12px 15px; margin-bottom: 8px; color: #64748b; cursor: pointer; border-radius: 10px; transition: 0.2s; font-size: 0.9rem; font-weight: 500; display: flex; align-items: center; gap: 10px; }
        .nav-item:hover { background: #f1f5f9; color: var(--primary); }
        .nav-item.active { background: #eff6ff; color: var(--primary); font-weight: 600; }
        .nav-home { margin-top: auto; background: #1e293b; color: white !important; }
        .nav-home:hover { background: #0f172a; }

        /* --- CONTENT --- */
        .main-content { flex: 1; background: #f8fafc; padding: 40px; overflow-y: auto; }
        .page-section { display: none; animation: fadeIn 0.4s ease; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        /* --- CARDS & FORMS --- */
        .card { background: white; padding: 30px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        h2 { margin-top: 0; color: var(--dark); border-bottom: 2px solid #f1f5f9; padding-bottom: 15px; font-size: 1.5rem; }
        
        /* INPUTS */
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        label { display: block; margin-top: 20px; font-weight: 600; color: #475569; font-size: 0.9rem; margin-bottom: 8px; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-family: inherit; transition: 0.3s; background: #f8fafc; }
        input:focus, textarea:focus { border-color: var(--primary); background: white; outline: none; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }
        
        /* BUTTONS */
        .btn { width: 100%; padding: 14px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; margin-top: 25px; transition: 0.2s; font-size: 1rem; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25); }
        .btn-primary:hover { transform: translateY(-2px); }
        .btn-excel { background: #10b981; color: white; width: auto; padding: 10px 20px; float: right; font-size: 0.9rem;}

        /* CANVAS */
        .sig-pad { border: 2px dashed #cbd5e1; border-radius: 10px; width: 100%; cursor: crosshair; background: #fff; }
        
        /* TABLE & NOTEPAD (Sama macam sebelum ni) */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #f1f5f9; padding: 15px; text-align: left; color: #475569; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; }
        td { padding: 15px; border-bottom: 1px solid #e2e8f0; color: #334155; }
        
        .note-card { background: white; padding: 20px; border-radius: 12px; border-left: 5px solid #ccc; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 15px; position: relative;}
        .note-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;}
        .close-btn { position: absolute; top:10px; right:10px; color:red; cursor:pointer;}

    </style>
</head>
<body>

    <div id="landing-page">
        <div class="landing-content">
            <div style="font-size: 4rem; margin-bottom: 10px;">üè´</div>
            <div class="landing-title">Portal Aset ICT</div>
            <div class="landing-subtitle">Sistem Pengurusan Serahan & Penyelenggaraan Aset</div>

            <div class="menu-grid">
                <div class="menu-card" onclick="enterSystem('page-cikgu')">
                    <span class="menu-icon">üì•</span>
                    <div class="menu-text">Serahan Aset</div>
                    <div class="menu-sub">Borang Penghantaran</div>
                </div>

                <div class="menu-card" onclick="enterSystem('page-admin-check')">
                    <span class="menu-icon">üîê</span>
                    <div class="menu-text">Admin IT</div>
                    <div class="menu-sub">Login Pegawai</div>
                </div>

                <div class="menu-card" onclick="enterSystem('page-notepad')">
                    <span class="menu-icon">üìå</span>
                    <div class="menu-text">Memo</div>
                    <div class="menu-sub">Catatan Peribadi</div>
                </div>
            </div>
        </div>
        <div style="position: absolute; bottom: 20px; color: #475569; font-size: 0.8rem;">
            Sistem Versi 5.0 ‚Ä¢ Build by Gemini
        </div>
    </div>

    <div id="app-container">
        
        <div class="sidebar">
            <div class="brand">üöÄ E-Aset Pro</div>
            
            <div class="nav-item" id="nav-cikgu" onclick="switchTab('page-cikgu')">üìù Borang Serahan</div>
            <div class="nav-item" id="nav-admin" onclick="checkAdmin()">üõ†Ô∏è Dashboard IT</div>
            <div class="nav-item" id="nav-note" onclick="switchTab('page-notepad')">üìå Notepad</div>

            <div class="nav-item nav-home" onclick="exitSystem()">üè† Menu Utama</div>
        </div>

        <div class="main-content">
            
            <div id="page-cikgu" class="page-section">
                <div class="card">
                    <h2>Borang Serahan Aset</h2>
                    <p style="color:#64748b">Sila isi butiran lengkap sebelum meninggalkan peralatan di makmal.</p>

                    <div class="form-row">
                        <div>
                            <label>Nama Penghantar</label>
                            <input type="text" id="c_name" placeholder="Nama Penuh">
                        </div>
                        <div>
                            <label>Jenis Aset</label>
                            <select id="c_asset">
                                <option>Printer</option>
                                <option>Laptop</option>
                                <option>PC Desktop</option>
                                <option>Projector</option>
                                <option>Lain-lain</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label>No. Siri / Aset (Wajib)</label>
                            <input type="text" id="c_serial" style="text-transform:uppercase; letter-spacing:1px">
                        </div>
                        <div>
                            <label>Tarikh</label>
                            <input type="date" id="c_date">
                        </div>
                    </div>

                    <label>Kerosakan / Catatan</label>
                    <textarea id="c_note" rows="3" placeholder="Terangkan masalah..."></textarea>

                    <label>Tandatangan</label>
                    <canvas id="cvs-cikgu" class="sig-pad" height="150"></canvas>
                    <div style="text-align:right; margin-top:5px; color:red; cursor:pointer; font-size:0.8rem" onclick="clearCvs('cvs-cikgu')">Padam Sign</div>

                    <button class="btn btn-primary" onclick="submitForm()">HANTAR BORANG</button>
                </div>
            </div>

            <div id="page-admin" class="page-section">
                <div class="card">
                    <div style="overflow:hidden; margin-bottom:20px;">
                        <h2 style="float:left; border:none; margin:0">Dashboard IT</h2>
                        <button class="btn-excel" onclick="downloadExcel()">üì• Download Excel</button>
                    </div>

                    <div id="pending-list" style="margin-bottom:30px"></div>

                    <h3 style="color:#475569">Pangkalan Data (Sejarah)</h3>
                    <div style="overflow-x:auto">
                        <table id="db-table">
                            <thead><tr><th>Tarikh</th><th>Nama</th><th>Aset (No Siri)</th><th>Status</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="page-process" class="page-section">
                <button onclick="switchTab('page-admin')" style="background:none; border:none; color:#64748b; cursor:pointer; margin-bottom:10px">‚¨Ö Kembali ke Dashboard</button>
                <div class="card" style="border-top:5px solid #f59e0b">
                    <h2>Proses Penerimaan</h2>
                    <div id="process-info" style="background:#eff6ff; padding:15px; border-radius:8px; margin-bottom:20px; color:#1e40af; line-height:1.6"></div>

                    <div class="form-row">
                        <div><label>Nama IT</label><input type="text" id="it_name"></div>
                        <div>
                            <label>Status</label>
                            <select id="it_status">
                                <option>Diterima - Baiki</option>
                                <option>Diterima - Simpan</option>
                                <option>Dikembalikan</option>
                            </select>
                        </div>
                    </div>

                    <label>Sign IT</label>
                    <canvas id="cvs-it" class="sig-pad" height="150"></canvas>
                    <button class="btn btn-primary" onclick="saveIT()">SIMPAN & SELESAI</button>
                </div>
            </div>

            <div id="page-notepad" class="page-section">
                <div class="card">
                    <h2>Memo & Nota</h2>
                    <div style="display:flex; gap:10px; align-items:center">
                        <input type="text" id="note-text" placeholder="Tulis nota cepat...">
                        <div style="display:flex; gap:5px">
                            <div onclick="currColor='blue'; alert('Biru')" style="width:25px; height:25px; background:#3b82f6; border-radius:50%; cursor:pointer; border:2px solid #ddd"></div>
                            <div onclick="currColor='yellow'; alert('Kuning')" style="width:25px; height:25px; background:#eab308; border-radius:50%; cursor:pointer; border:2px solid #ddd"></div>
                        </div>
                    </div>
                    <button class="btn btn-primary" style="margin-top:10px" onclick="addNote()">TAMBAH NOTA</button>

                    <div id="note-grid" class="note-grid"></div>
                </div>
            </div>

        </div>
    </div>

<script>
    // --- 1. TRANSISI MENU UTAMA ---
    function enterSystem(target) {
        if(target === 'page-admin-check') {
            checkAdmin();
            return;
        }
        // Animasi masuk
        document.getElementById('landing-page').style.transform = 'translateY(-100%)';
        setTimeout(() => {
            document.getElementById('app-container').classList.add('active');
            switchTab(target);
        }, 300);
    }

    function exitSystem() {
        // Animasi keluar
        document.getElementById('app-container').classList.remove('active');
        setTimeout(() => {
            document.getElementById('landing-page').style.transform = 'translateY(0)';
        }, 300);
    }

    // --- 2. SISTEM TABS ---
    function switchTab(id) {
        document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        // Update Sidebar Active Class
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        if(id === 'page-cikgu') document.getElementById('nav-cikgu').classList.add('active');
        if(id === 'page-admin' || id === 'page-process') document.getElementById('nav-admin').classList.add('active');
        if(id === 'page-notepad') {
            document.getElementById('nav-note').classList.add('active');
            renderNotes();
        }

        // Resize Canvas fix
        setTimeout(() => { 
            const c1 = document.getElementById('cvs-cikgu'); c1.width = c1.parentElement.offsetWidth;
            const c2 = document.getElementById('cvs-it'); c2.width = c2.parentElement.offsetWidth;
        }, 100);
    }

    // --- 3. DATA & LOGIC ---
    let db = JSON.parse(localStorage.getItem('asetDB_v5')) || [];
    let notes = JSON.parse(localStorage.getItem('notesDB')) || [];
    let currColor = 'blue';
    let currentId = null;

    document.getElementById('c_date').valueAsDate = new Date();

    // Setup Canvas
    function setupCanvas(id) {
        const c = document.getElementById(id);
        const ctx = c.getContext('2d');
        let drawing = false;
        c.addEventListener('mousedown', (e)=>{drawing=true; ctx.beginPath(); ctx.moveTo(e.offsetX, e.offsetY)});
        c.addEventListener('mousemove', (e)=>{if(drawing){ctx.lineTo(e.offsetX, e.offsetY); ctx.stroke()}});
        c.addEventListener('mouseup', ()=>{drawing=false});
        // Touch support skipped for brevity but same as V4
    }
    setupCanvas('cvs-cikgu'); setupCanvas('cvs-it');
    function clearCvs(id) { 
        const c = document.getElementById(id); 
        c.getContext('2d').clearRect(0,0,c.width,c.height); 
    }

    // SUBMIT FORM
    function submitForm() {
        const name = document.getElementById('c_name').value;
        const serial = document.getElementById('c_serial').value.toUpperCase();
        if(!name || !serial) return alert("Sila isi Nama & No Siri!");

        db.push({
            id: Date.now(),
            dateIn: document.getElementById('c_date').value,
            name, serial, 
            asset: document.getElementById('c_asset').value,
            note: document.getElementById('c_note').value,
            itStatus: 'PENDING', itName: '-', dateOut: '-'
        });
        localStorage.setItem('asetDB_v5', JSON.stringify(db));
        alert("‚úÖ Berjaya Hantar!");
        document.getElementById('c_name').value = "";
        document.getElementById('c_serial').value = "";
        document.getElementById('c_note').value = "";
        clearCvs('cvs-cikgu');
    }

    // ADMIN
    function checkAdmin() {
        let p = prompt("Password IT:");
        if(p === "admin123") {
            // Kalau dari landing page, kena masuk dulu
            document.getElementById('landing-page').style.transform = 'translateY(-100%)';
            document.getElementById('app-container').classList.add('active');
            
            switchTab('page-admin');
            renderAdmin();
        } else if (p) alert("Salah Password!");
    }

    function renderAdmin() {
        const list = document.getElementById('pending-list');
        const tbody = document.querySelector('#db-table tbody');
        list.innerHTML = ""; tbody.innerHTML = "";
        let pending = false;

        db.slice().reverse().forEach(item => {
            // Table
            let badge = item.itStatus === 'PENDING' ? '‚è≥ Pending' : '‚úÖ ' + item.itStatus;
            tbody.innerHTML += `<tr><td>${item.dateIn}</td><td>${item.name}</td><td>${item.asset}<br><small>${item.serial}</small></td><td>${badge}</td></tr>`;

            // Pending Box
            if(item.itStatus === 'PENDING') {
                pending = true;
                list.innerHTML += `
                <div style="background:#fffbeb; border:1px solid #fcd34d; padding:15px; margin-bottom:10px; border-radius:8px; display:flex; justify-content:space-between; align-items:center;">
                    <div><b>${item.asset}</b> (${item.serial}) <br> <small>${item.name} - ${item.note}</small></div>
                    <button onclick="process(${item.id})" style="background:#f59e0b; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer">Proses</button>
                </div>`;
            }
        });
        if(!pending) list.innerHTML = "<p style='text-align:center; color:#94a3b8'>Tiada tugasan baru.</p>";
    }

    function process(id) {
        currentId = id;
        const item = db.find(x => x.id === id);
        document.getElementById('process-info').innerHTML = `<b>Dari:</b> ${item.name}<br><b>Aset:</b> ${item.asset} (${item.serial})<br><b>Masalah:</b> ${item.note}`;
        clearCvs('cvs-it');
        switchTab('page-process');
    }

    function saveIT() {
        const idx = db.findIndex(x => x.id === currentId);
        if(idx !== -1) {
            db[idx].itName = document.getElementById('it_name').value;
            db[idx].itStatus = document.getElementById('it_status').value;
            db[idx].dateOut = new Date().toLocaleDateString('ms-MY');
            localStorage.setItem('asetDB_v5', JSON.stringify(db));
            alert("Disimpan!");
            switchTab('page-admin');
            renderAdmin();
        }
    }

    function downloadExcel() {
        let csv = "ID,Tarikh,Nama,Aset,Serial,Nota,Status\n";
        db.forEach(r => {
            const clean = t => `"${String(t).replace(/"/g, '""')}"`;
            csv += `${r.id},${clean(r.dateIn)},${clean(r.name)},${clean(r.asset)},${clean(r.serial)},${clean(r.note)},${clean(r.itStatus)}\n`;
        });
        const link = document.createElement('a');
        link.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
        link.download = 'Data_Aset.csv';
        link.click();
    }

    // NOTEPAD
    function addNote() {
        const txt = document.getElementById('note-text').value;
        if(txt) {
            notes.push({ id: Date.now(), text: txt, color: currColor });
            localStorage.setItem('notesDB', JSON.stringify(notes));
            document.getElementById('note-text').value = "";
            renderNotes();
        }
    }
    function renderNotes() {
        const g = document.getElementById('note-grid');
        g.innerHTML = "";
        notes.slice().reverse().forEach(n => {
            g.innerHTML += `<div class="note-card" style="border-left-color:${n.color==='blue'?'#3b82f6':'#eab308'}">
                <div class="close-btn" onclick="delNote(${n.id})">‚úï</div>
                ${n.text}
            </div>`;
        });
    }
    function delNote(id) {
        notes = notes.filter(n => n.id !== id);
        localStorage.setItem('notesDB', JSON.stringify(notes));
        renderNotes();
    }
</script>

</body>
</html>
